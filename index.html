<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstateX - Premium Real Estate</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Hide scrollbar for gallery */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Smooth scroll behavior */
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-white text-slate-800 antialiased">

    <!-- Navigation Bar -->
    <div id="navbar-container"></div>

    <!-- Main Content Area -->
    <main id="app-root"></main>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800 text-slate-400 py-12 mt-auto">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div class="col-span-1 md:col-span-2">
                <div class="flex items-center space-x-2 mb-4">
                    <div class="bg-indigo-600 p-2 rounded-lg">
                        <i data-lucide="home" class="text-white w-4 h-4"></i>
                    </div>
                    <span class="text-2xl font-bold text-white">Estate<span class="text-indigo-500">X</span></span>
                </div>
                <p class="max-w-xs text-sm">India's most innovative real estate platform. We make buying, selling, and renting properties effortless and transparent.</p>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4">Company</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="hover:text-indigo-400">About Us</a></li>
                    <li><a href="#" class="hover:text-indigo-400">Careers</a></li>
                    <li><a href="#" class="hover:text-indigo-400">Terms & Conditions</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4">Connect</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="hover:text-indigo-400">Contact Support</a></li>
                    <li><a href="#" class="hover:text-indigo-400">Twitter</a></li>
                    <li><a href="#" class="hover:text-indigo-400">Instagram</a></li>
                </ul>
            </div>
        </div>
        <div class="max-w-7xl mx-auto px-4 mt-12 pt-8 border-t border-slate-800 text-xs text-center">
            &copy; 2024 EstateX Technologies Pvt Ltd. All rights reserved.
        </div>
    </footer>

    <!-- Auth Modal Container -->
    <div id="auth-modal-container"></div>

    <!-- JavaScript Logic -->
    <script>
        /* --- MOCK DATA --- */
        const CITIES = ["Mumbai", "Bangalore", "Delhi NCR", "Pune", "Hyderabad"];
        const TYPES = ["Apartment", "Villa", "Plot", "Penthouse"];
        
        const PROPERTIES = [
            {
                id: 1,
                title: "Azure Sky Penthouse",
                location: "Bandra West, Mumbai",
                city: "Mumbai",
                price: 85000000,
                rentPrice: 250000,
                type: "Penthouse",
                listingType: "buy",
                bhk: 4,
                bathrooms: 5,
                area: 4200,
                rating: 4.8,
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1512917774080-9991f1c4c750", "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c"],
                description: "Experience the pinnacle of luxury living in this sprawling penthouse overlooking the Arabian Sea.",
                amenities: ["Swimming Pool", "Gym", "Security", "Club House", "Power Backup"],
                postedBy: "Luxury Estates Ltd",
                isNew: true,
            },
            {
                id: 2,
                title: "Green Valley Villa",
                location: "Whitefield, Bangalore",
                city: "Bangalore",
                price: 45000000,
                rentPrice: 120000,
                type: "Villa",
                listingType: "buy",
                bhk: 5,
                bathrooms: 6,
                area: 5500,
                rating: 4.5,
                image: "https://images.unsplash.com/photo-1600596542815-2250c385e311?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1600596542815-2250c385e311", "https://images.unsplash.com/photo-1564013799919-ab600027ffc6"],
                description: "A serene escape in the heart of the tech hub with a landscaped garden.",
                amenities: ["Garden", "Parking", "Security", "Solar Power"],
                postedBy: "Green Homes",
                isNew: false,
            },
            {
                id: 3,
                title: "Urban Heights 2BHK",
                location: "Koramangala, Bangalore",
                city: "Bangalore",
                price: 12000000,
                rentPrice: 45000,
                type: "Apartment",
                listingType: "rent",
                bhk: 2,
                bathrooms: 2,
                area: 1200,
                rating: 4.2,
                image: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2"],
                description: "Modern apartment perfect for young professionals. Close to major IT parks.",
                amenities: ["Gym", "Security", "Parking"],
                postedBy: "Urban Realty",
                isNew: true,
            },
            {
                id: 7,
                title: "Royal Jubilee Villa",
                location: "Jubilee Hills, Hyderabad",
                city: "Hyderabad",
                price: 125000000,
                rentPrice: 400000,
                type: "Villa",
                listingType: "buy",
                bhk: 6,
                bathrooms: 7,
                area: 7500,
                rating: 4.9,
                image: "https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1613977257363-707ba9348227"],
                description: "Architectural masterpiece in the prestigious Jubilee Hills.",
                amenities: ["Pool", "Gym", "Home Theater", "Servant Quarters"],
                postedBy: "Deccan Luxury",
                isNew: true,
            },
            {
                id: 10,
                title: "Chattarpur Farmhouse",
                location: "Chattarpur, Delhi NCR",
                city: "Delhi NCR",
                price: 180000000,
                rentPrice: 0,
                type: "Villa",
                listingType: "buy",
                bhk: 5,
                bathrooms: 6,
                area: 15000,
                rating: 4.8,
                image: "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1564013799919-ab600027ffc6"],
                description: "Sprawling farmhouse suitable for events or luxurious living.",
                amenities: ["Swimming Pool", "Lawn", "Parking"],
                postedBy: "Delhi Elite",
                isNew: false,
            },
             {
                id: 9,
                title: "Silicon Tech Park",
                location: "Electronic City, Bangalore",
                city: "Bangalore",
                price: 150000000,
                rentPrice: 600000,
                type: "Commercial",
                listingType: "rent",
                bhk: 0,
                bathrooms: 4,
                area: 12000,
                rating: 4.6,
                image: "https://images.unsplash.com/photo-1497215728101-856f4ea42174?auto=format&fit=crop&q=80&w=1000",
                images: ["https://images.unsplash.com/photo-1497215728101-856f4ea42174"],
                description: "Grade A office space fully furnished with 150 workstations.",
                amenities: ["Central AC", "Power Backup", "Cafeteria"],
                postedBy: "Bangalore Commercials",
                isNew: false,
            }
        ];

        /* --- STATE MANAGEMENT --- */
        const state = {
            view: 'home', // home, explore, details, dashboard
            user: null, // {name, email}
            selectedId: null,
            favorites: [],
            appointments: [],
            scrolled: false,
            mobileMenuOpen: false,
            authModalOpen: false,
            authMode: 'login',
            filters: {
                listingType: 'all',
                location: '',
                type: ''
            },
            // For details view
            activeImgIndex: 0,
            bookingForm: { show: false, date: '', time: '', confirmed: false }
        };

        /* --- UTILS --- */
        const formatPrice = (price, type) => {
            if (price >= 10000000) return `₹ ${(price / 10000000).toFixed(2)} Cr`;
            if (price >= 100000) return `₹ ${(price / 100000).toFixed(2)} L`;
            return `₹ ${price.toLocaleString()}`;
        };

        /* --- RENDER FUNCTIONS --- */

        function renderApp() {
            renderNavbar();
            const root = document.getElementById('app-root');
            root.innerHTML = ''; // Clear content

            if (state.view === 'home') root.innerHTML = renderHome();
            else if (state.view === 'explore') root.innerHTML = renderExplore();
            else if (state.view === 'details') root.innerHTML = renderDetails();
            else if (state.view === 'dashboard') root.innerHTML = renderDashboard();

            renderAuthModal();
            lucide.createIcons(); // Re-initialize icons
        }

        // --- NAVBAR COMPONENT ---
        function renderNavbar() {
            const nav = document.getElementById('navbar-container');
            const navClasses = state.scrolled 
                ? 'top-4 left-4 right-4 md:left-1/2 md:right-auto md:-translate-x-1/2 md:w-[90%] md:max-w-6xl rounded-full bg-white/90 backdrop-blur-md shadow-2xl py-3 border border-white/20' 
                : 'top-0 left-0 right-0 bg-transparent py-6';
            
            const textClass = state.scrolled ? 'text-slate-900' : 'text-slate-900 lg:text-white';
            const linkClass = state.scrolled ? 'text-slate-600 hover:text-indigo-600 hover:bg-indigo-50' : 'text-slate-200 hover:text-white hover:bg-white/10';

            nav.innerHTML = `
                <nav class="fixed z-50 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] ${navClasses}">
                    <div class="px-6 md:px-8 flex justify-between items-center ${state.scrolled ? 'w-full' : 'max-w-7xl mx-auto'}">
                        <!-- Logo -->
                        <div class="flex items-center space-x-2 cursor-pointer" onclick="actions.setView('home')">
                            <div class="bg-indigo-600 p-2 rounded-lg">
                                <i data-lucide="home" class="text-white w-6 h-6"></i>
                            </div>
                            <span class="text-2xl font-bold tracking-tight transition-colors duration-300 ${textClass}">
                                Estate<span class="text-indigo-500">X</span>
                            </span>
                        </div>

                        <!-- Desktop Links -->
                        <div class="hidden md:flex items-center space-x-1">
                            ${['Home', 'Buy', 'Rent', 'Commercial'].map(item => `
                                <button onclick="actions.navClick('${item}')" class="relative px-5 py-2 rounded-full font-medium text-sm transition-all duration-300 group ${linkClass}">
                                    ${item}
                                </button>
                            `).join('')}
                        </div>

                        <!-- Auth/User -->
                        <div class="hidden md:flex items-center space-x-4">
                            ${state.user ? `
                                <button onclick="actions.setView('dashboard')" class="flex items-center space-x-2 px-4 py-2 rounded-full border transition-all ${state.scrolled ? 'border-slate-200 text-slate-700 hover:bg-slate-50' : 'border-white/20 text-white hover:bg-white/10'}">
                                    <i data-lucide="user" width="18"></i>
                                    <span>Dashboard</span>
                                </button>
                            ` : `
                                <button onclick="actions.openAuth()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2.5 rounded-full font-medium shadow-lg shadow-indigo-500/30 transition-all transform hover:-translate-y-0.5">
                                    Login
                                </button>
                            `}
                        </div>

                        <!-- Mobile Toggle -->
                        <button class="md:hidden transition-colors ${textClass}" onclick="actions.toggleMobileMenu()">
                            <i data-lucide="${state.mobileMenuOpen ? 'x' : 'menu'}"></i>
                        </button>
                    </div>

                    <!-- Mobile Menu -->
                    <div class="${state.mobileMenuOpen ? 'block' : 'hidden'} absolute top-full left-0 right-0 mt-2 mx-4 bg-white rounded-2xl border border-gray-100 shadow-xl p-4 flex flex-col space-y-2 animate-fadeIn">
                         ${['Home', 'Buy', 'Rent', 'Commercial'].map(item => `
                            <button onclick="actions.navClick('${item}')" class="text-left px-4 py-3 rounded-xl font-medium text-slate-700 hover:bg-slate-50">${item}</button>
                        `).join('')}
                        <div class="h-px bg-slate-100 my-2"></div>
                        ${state.user ? 
                            `<button onclick="actions.setView('dashboard')" class="text-left px-4 py-3 rounded-xl font-medium text-indigo-600 bg-indigo-50">Dashboard</button>` : 
                            `<button onclick="actions.openAuth()" class="text-left px-4 py-3 rounded-xl font-medium text-white bg-indigo-600">Login / Sign Up</button>`
                        }
                    </div>
                </nav>
            `;
        }

        // --- HOME VIEW ---
        function renderHome() {
            return `
                <div class="animate-fadeIn">
                    <!-- Hero -->
                    <div class="relative h-[600px] flex items-center justify-center">
                        <div class="absolute inset-0 z-0">
                            <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&q=80&w=2000" class="w-full h-full object-cover" />
                            <div class="absolute inset-0 bg-slate-900/60"></div>
                        </div>
                        <div class="relative z-10 w-full max-w-5xl px-4 text-center">
                            <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
                                Find your place to <br class="hidden md:block"/> call <span class="text-indigo-400">Home</span>.
                            </h1>
                            <p class="text-slate-200 mb-10 text-lg max-w-2xl mx-auto">Explore over 15,000+ properties for sale and rent.</p>
                            
                            <!-- Search Bar -->
                            <div class="bg-white p-2 rounded-2xl shadow-2xl max-w-4xl mx-auto flex flex-col md:flex-row gap-2">
                                <div class="flex bg-slate-100 rounded-xl p-1 md:w-48 flex-shrink-0">
                                    <button onclick="actions.setFilter('listingType', 'buy')" class="flex-1 rounded-lg text-sm font-bold py-3 transition-all ${state.filters.listingType === 'buy' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}">Buy</button>
                                    <button onclick="actions.setFilter('listingType', 'rent')" class="flex-1 rounded-lg text-sm font-bold py-3 transition-all ${state.filters.listingType === 'rent' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}">Rent</button>
                                </div>
                                <div class="relative flex-grow group">
                                    <i data-lucide="map-pin" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                                    <select onchange="actions.setFilter('location', this.value)" class="w-full h-full bg-slate-50 md:bg-transparent rounded-xl md:rounded-none pl-12 pr-4 py-3 md:py-0 text-slate-700 font-medium focus:outline-none appearance-none cursor-pointer">
                                        <option value="">Select Location</option>
                                        ${CITIES.map(c => `<option value="${c}" ${state.filters.location === c ? 'selected' : ''}>${c}</option>`).join('')}
                                    </select>
                                </div>
                                <button onclick="actions.setView('explore')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-indigo-500/30 flex items-center justify-center">
                                    <i data-lucide="search" class="w-4 h-4 mr-2"></i> Search
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Featured Properties -->
                    <div class="max-w-7xl mx-auto px-4 py-20">
                        <div class="flex justify-between items-end mb-10">
                            <div>
                                <h2 class="text-3xl font-bold text-slate-900 mb-2">Featured Properties</h2>
                                <p class="text-slate-500">Handpicked selections just for you</p>
                            </div>
                            <button onclick="actions.setView('explore')" class="hidden md:flex items-center text-indigo-600 font-bold hover:text-indigo-700">
                                View All <i data-lucide="chevron-right" class="ml-1 w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            ${PROPERTIES.slice(0, 3).map(p => renderPropertyCard(p)).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- EXPLORE VIEW ---
        function renderExplore() {
            // Filter logic
            const filtered = PROPERTIES.filter(p => {
                if (state.filters.listingType !== 'all' && p.listingType !== state.filters.listingType) return false;
                if (state.filters.location && p.city !== state.filters.location) return false;
                if (state.filters.type && p.type !== state.filters.type) return false;
                return true;
            });

            return `
                <div class="animate-fadeIn pt-32 pb-20 max-w-7xl mx-auto px-4">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                        <h1 class="text-2xl font-bold text-slate-900">
                            Properties ${state.filters.location ? `in ${state.filters.location}` : ''}
                            <span class="text-slate-400 text-lg font-normal ml-2">(${filtered.length} results)</span>
                        </h1>
                        <div class="flex gap-2">
                             ${['all', 'buy', 'rent'].map(type => `
                                <button onclick="actions.setFilter('listingType', '${type}')" class="px-4 py-2 rounded-lg text-sm font-bold capitalize ${state.filters.listingType === type ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-600'}">${type}</button>
                             `).join('')}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${filtered.length > 0 
                            ? filtered.map(p => renderPropertyCard(p)).join('') 
                            : `<div class="col-span-full py-20 text-center"><p class="text-slate-400 text-lg">No properties found.</p><button onclick="actions.clearFilters()" class="mt-4 text-indigo-600 font-bold hover:underline">Clear Filters</button></div>`
                        }
                    </div>
                </div>
            `;
        }

        // --- PROPERTY CARD COMPONENT ---
        function renderPropertyCard(p) {
            const isFav = state.favorites.includes(p.id);
            const price = formatPrice(p.listingType === 'rent' ? p.rentPrice : p.price);
            
            return `
                <div class="group bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 flex flex-col h-full cursor-pointer relative" onclick="actions.openDetails(${p.id})">
                    <div class="relative h-64 overflow-hidden">
                        <img src="${p.image}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700" alt="${p.title}" />
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        
                        <div class="absolute top-4 left-4 flex space-x-2">
                            <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider ${p.listingType === 'rent' ? 'bg-amber-100 text-amber-800' : 'bg-indigo-100 text-indigo-800'}">
                                ${p.listingType === 'rent' ? 'For Rent' : 'For Sale'}
                            </span>
                            ${p.isNew ? '<span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-green-100 text-green-800">New</span>' : ''}
                        </div>

                        <button onclick="event.stopPropagation(); actions.toggleFavorite(${p.id})" class="absolute top-4 right-4 p-2 bg-white/20 backdrop-blur-md hover:bg-white rounded-full transition-all text-white hover:text-red-500">
                            <i data-lucide="heart" class="w-5 h-5 ${isFav ? 'fill-red-500 text-red-500' : ''}"></i>
                        </button>

                        <div class="absolute bottom-4 left-4 text-white font-bold text-xl drop-shadow-md">
                           ${price} ${p.listingType === 'rent' ? '<span class="text-sm font-normal text-white/80">/mo</span>' : ''}
                        </div>
                    </div>

                    <div class="p-5 flex flex-col flex-grow">
                        <h3 class="text-lg font-bold text-slate-800 group-hover:text-indigo-600 transition-colors line-clamp-1">${p.title}</h3>
                        <p class="text-slate-500 text-sm flex items-center mt-1"><i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> ${p.location}</p>
                        
                        <div class="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-slate-100">
                             <div class="flex flex-col items-center justify-center p-2 bg-slate-50 rounded-lg">
                                 <i data-lucide="bed-double" class="w-4 h-4 text-slate-400 mb-1"></i>
                                 <span class="text-xs font-semibold text-slate-700">${p.bhk || 0} BHK</span>
                             </div>
                             <div class="flex flex-col items-center justify-center p-2 bg-slate-50 rounded-lg">
                                 <i data-lucide="bath" class="w-4 h-4 text-slate-400 mb-1"></i>
                                 <span class="text-xs font-semibold text-slate-700">${p.bathrooms} Bath</span>
                             </div>
                             <div class="flex flex-col items-center justify-center p-2 bg-slate-50 rounded-lg">
                                 <i data-lucide="square" class="w-4 h-4 text-slate-400 mb-1"></i>
                                 <span class="text-xs font-semibold text-slate-700">${p.area} sqft</span>
                             </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- DETAILS VIEW ---
        function renderDetails() {
            const p = PROPERTIES.find(prop => prop.id === state.selectedId);
            if (!p) return '';
            
            const isFav = state.favorites.includes(p.id);
            const price = formatPrice(p.listingType === 'rent' ? p.rentPrice : p.price);
            const currentImg = p.images[state.activeImgIndex] || p.image;

            return `
                <div class="animate-fadeIn pb-20 pt-32 bg-slate-50 min-h-screen">
                    <div class="max-w-7xl mx-auto px-4 md:px-8">
                        <button onclick="actions.setView('explore')" class="flex items-center text-slate-500 hover:text-indigo-600 mb-6 transition-colors">
                            <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i> Back to Search
                        </button>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Left: Content -->
                            <div class="lg:col-span-2 space-y-8">
                                <div class="space-y-4">
                                    <div class="h-96 md:h-[500px] w-full rounded-2xl overflow-hidden shadow-lg relative">
                                        <img src="${currentImg}" class="w-full h-full object-cover" />
                                        <button onclick="actions.toggleFavorite(${p.id})" class="absolute top-4 right-4 bg-white/90 p-3 rounded-full shadow-lg">
                                            <i data-lucide="heart" class="w-6 h-6 ${isFav ? 'fill-red-500 text-red-500' : 'text-slate-400'}"></i>
                                        </button>
                                    </div>
                                    <div class="flex space-x-4 overflow-x-auto pb-2 no-scrollbar">
                                        ${p.images.map((img, idx) => `
                                            <button onclick="actions.setActiveImage(${idx})" class="relative w-24 h-24 flex-shrink-0 rounded-xl overflow-hidden border-2 ${state.activeImgIndex === idx ? 'border-indigo-600' : 'border-transparent'}">
                                                <img src="${img}" class="w-full h-full object-cover" />
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                        <div>
                                            <h1 class="text-3xl font-bold text-slate-900 mb-2">${p.title}</h1>
                                            <div class="flex items-center text-slate-500">
                                                <i data-lucide="map-pin" class="w-4 h-4 mr-1 text-indigo-500"></i> ${p.location}
                                            </div>
                                        </div>
                                        <div class="mt-4 md:mt-0 text-left md:text-right">
                                            <div class="text-3xl font-bold text-indigo-600">${price}</div>
                                            ${p.listingType === 'rent' ? '<span class="text-slate-400 text-sm">per month</span>' : ''}
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-y border-slate-100">
                                        <div class="text-center"><div class="text-slate-400 text-xs uppercase mb-1">Type</div><div class="font-semibold">${p.type}</div></div>
                                        <div class="text-center border-l"><div class="text-slate-400 text-xs uppercase mb-1">Area</div><div class="font-semibold">${p.area} sqft</div></div>
                                        <div class="text-center border-l"><div class="text-slate-400 text-xs uppercase mb-1">Beds</div><div class="font-semibold">${p.bhk || '-'}</div></div>
                                        <div class="text-center border-l"><div class="text-slate-400 text-xs uppercase mb-1">Bath</div><div class="font-semibold">${p.bathrooms}</div></div>
                                    </div>

                                    <div class="mt-8">
                                        <h3 class="text-xl font-bold text-slate-900 mb-4">Description</h3>
                                        <p class="text-slate-600 leading-relaxed">${p.description}</p>
                                    </div>

                                    <div class="mt-8">
                                        <h3 class="text-xl font-bold text-slate-900 mb-4">Amenities</h3>
                                        <div class="flex flex-wrap gap-3">
                                            ${p.amenities.map(a => `<span class="px-4 py-2 bg-slate-50 rounded-lg text-slate-700 text-sm font-medium border border-slate-100">${a}</span>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Contact -->
                            <div class="lg:col-span-1">
                                <div class="sticky top-28 space-y-6">
                                    <div class="bg-white rounded-2xl p-6 shadow-lg shadow-indigo-100 border border-slate-100">
                                        <div class="flex items-center space-x-4 mb-6">
                                            <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold text-lg">${p.postedBy.charAt(0)}</div>
                                            <div>
                                                <div class="font-bold text-slate-900">${p.postedBy}</div>
                                                <div class="text-xs text-slate-500">Certified Agent</div>
                                            </div>
                                        </div>

                                        ${!state.bookingForm.show ? `
                                            <button class="w-full py-3 mb-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-indigo-500/30">Contact Agent</button>
                                            <button onclick="actions.toggleBooking(true)" class="w-full py-3 bg-white border-2 border-slate-200 hover:border-indigo-600 text-slate-700 hover:text-indigo-600 rounded-xl font-bold transition-all">Book a Visit</button>
                                        ` : `
                                            <div class="bg-slate-50 p-4 rounded-xl animate-fadeIn">
                                                ${state.bookingForm.confirmed ? `
                                                    <div class="text-center py-8">
                                                        <i data-lucide="check-circle" class="w-12 h-12 text-green-500 mx-auto mb-3"></i>
                                                        <h4 class="font-bold text-slate-900">Booking Confirmed!</h4>
                                                    </div>
                                                ` : `
                                                    <div class="flex justify-between items-center mb-4">
                                                        <h4 class="font-bold text-slate-900">Schedule Visit</h4>
                                                        <button onclick="actions.toggleBooking(false)"><i data-lucide="x" class="w-4 h-4 text-slate-400"></i></button>
                                                    </div>
                                                    <div class="space-y-4">
                                                        <input type="date" onchange="actions.updateBooking('date', this.value)" class="w-full p-2 rounded-lg border text-sm" />
                                                        <select onchange="actions.updateBooking('time', this.value)" class="w-full p-2 rounded-lg border text-sm">
                                                            <option value="">Select Time</option>
                                                            <option>10:00 AM</option>
                                                            <option>02:00 PM</option>
                                                        </select>
                                                        <button onclick="actions.confirmBooking()" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold text-sm">Confirm</button>
                                                    </div>
                                                `}
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- DASHBOARD VIEW ---
        function renderDashboard() {
            const favProps = PROPERTIES.filter(p => state.favorites.includes(p.id));
            
            return `
                <div class="pt-32 pb-20 min-h-screen bg-slate-50">
                    <div class="max-w-7xl mx-auto px-4">
                        <h2 class="text-2xl font-bold text-slate-900 mb-6">Welcome, ${state.user.name}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                            <!-- Sidebar -->
                            <div class="col-span-1">
                                <div class="bg-white rounded-2xl shadow-sm p-6 text-center border border-slate-100">
                                    <div class="w-20 h-20 rounded-full bg-slate-200 mx-auto mb-4 flex items-center justify-center">
                                        <i data-lucide="user" class="w-10 h-10 text-slate-400"></i>
                                    </div>
                                    <h3 class="font-bold">${state.user.name}</h3>
                                    <p class="text-sm text-slate-500">${state.user.email}</p>
                                    <button onclick="actions.logout()" class="mt-4 text-red-500 text-sm font-bold">Logout</button>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="col-span-1 md:col-span-3 space-y-8">
                                <div>
                                    <h3 class="text-xl font-bold mb-4">My Favorites</h3>
                                    ${favProps.length === 0 
                                        ? `<div class="p-8 bg-white rounded-xl text-center border border-dashed border-slate-300 text-slate-500">No favorites yet.</div>`
                                        : `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">${favProps.map(p => renderPropertyCard(p)).join('')}</div>`
                                    }
                                </div>
                                
                                <div>
                                    <h3 class="text-xl font-bold mb-4">Appointments</h3>
                                    ${state.appointments.length === 0
                                        ? `<div class="p-8 bg-white rounded-xl text-center border border-dashed border-slate-300 text-slate-500">No appointments yet.</div>`
                                        : `<div class="bg-white rounded-xl border border-slate-100 divide-y divide-slate-50">
                                            ${state.appointments.map(apt => `
                                                <div class="p-4 flex justify-between items-center">
                                                    <div>
                                                        <div class="font-bold">${apt.propertyTitle}</div>
                                                        <div class="text-xs text-slate-500">${apt.date} at ${apt.time}</div>
                                                    </div>
                                                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-lg text-xs font-bold">Confirmed</span>
                                                </div>
                                            `).join('')}
                                           </div>`
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- AUTH MODAL ---
        function renderAuthModal() {
            const container = document.getElementById('auth-modal-container');
            if (!state.authModalOpen) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = `
                <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn">
                    <div class="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl relative p-8">
                        <button onclick="actions.closeAuth()" class="absolute top-4 right-4 p-2 bg-slate-100 rounded-full hover:bg-slate-200">
                            <i data-lucide="x" class="w-5 h-5 text-slate-600"></i>
                        </button>
                        
                        <div class="text-center mb-8">
                            <h2 class="text-2xl font-bold text-slate-900">${state.authMode === 'login' ? 'Welcome Back' : 'Create Account'}</h2>
                            <p class="text-slate-500 text-sm mt-2">Enter your details to access your dashboard.</p>
                        </div>

                        <div class="space-y-4">
                            ${state.authMode === 'signup' ? `
                                <div><label class="block text-xs font-bold text-slate-700 uppercase mb-1">Name</label>
                                <input type="text" class="w-full p-3 rounded-xl border border-slate-200" placeholder="John Doe"></div>
                            ` : ''}
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Email</label>
                                <input type="email" class="w-full p-3 rounded-xl border border-slate-200" placeholder="user@estatex.com">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Password</label>
                                <input type="password" class="w-full p-3 rounded-xl border border-slate-200" placeholder="••••••••">
                            </div>
                            <button onclick="actions.login()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg transition-all">
                                ${state.authMode === 'login' ? 'Sign In' : 'Sign Up'}
                            </button>
                        </div>
                        
                        <div class="mt-6 text-center text-sm text-slate-500">
                            ${state.authMode === 'login' ? "Don't have an account?" : "Already have an account?"}
                            <button onclick="actions.toggleAuthMode()" class="text-indigo-600 font-bold hover:underline">
                                ${state.authMode === 'login' ? 'Sign Up' : 'Login'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        /* --- ACTIONS (Controller) --- */
        const actions = {
            setView: (view) => {
                state.view = view;
                state.mobileMenuOpen = false;
                window.scrollTo(0, 0);
                renderApp();
            },
            navClick: (item) => {
                if (item === 'Home') actions.setView('home');
                else {
                    if(item !== 'Home') {
                         state.filters.listingType = item.toLowerCase() === 'commercial' ? 'all' : item.toLowerCase();
                         if(item === 'Commercial') state.filters.type = 'Commercial';
                         else state.filters.type = '';
                    }
                    actions.setView('explore');
                }
            },
            toggleMobileMenu: () => {
                state.mobileMenuOpen = !state.mobileMenuOpen;
                renderApp();
            },
            setFilter: (key, value) => {
                state.filters[key] = value;
                renderApp();
            },
            clearFilters: () => {
                state.filters = { listingType: 'all', location: '', type: '' };
                renderApp();
            },
            openDetails: (id) => {
                state.selectedId = id;
                state.activeImgIndex = 0;
                state.bookingForm = { show: false, date: '', time: '', confirmed: false };
                actions.setView('details');
            },
            setActiveImage: (idx) => {
                state.activeImgIndex = idx;
                renderApp();
            },
            toggleFavorite: (id) => {
                if (!state.user) {
                    actions.openAuth();
                    return;
                }
                if (state.favorites.includes(id)) {
                    state.favorites = state.favorites.filter(fid => fid !== id);
                } else {
                    state.favorites.push(id);
                }
                renderApp();
            },
            openAuth: () => {
                state.authModalOpen = true;
                renderApp();
            },
            closeAuth: () => {
                state.authModalOpen = false;
                renderApp();
            },
            toggleAuthMode: () => {
                state.authMode = state.authMode === 'login' ? 'signup' : 'login';
                renderApp();
            },
            login: () => {
                // Mock Login
                state.user = { name: 'Demo User', email: 'user@estatex.com' };
                state.authModalOpen = false;
                actions.setView('dashboard');
            },
            logout: () => {
                state.user = null;
                actions.setView('home');
            },
            toggleBooking: (show) => {
                if(!state.user) { actions.openAuth(); return; }
                state.bookingForm.show = show;
                renderApp();
            },
            updateBooking: (field, val) => {
                state.bookingForm[field] = val;
            },
            confirmBooking: () => {
                if(!state.bookingForm.date || !state.bookingForm.time) return;
                const prop = PROPERTIES.find(p => p.id === state.selectedId);
                state.appointments.push({
                    propertyId: prop.id,
                    propertyTitle: prop.title,
                    date: state.bookingForm.date,
                    time: state.bookingForm.time
                });
                state.bookingForm.confirmed = true;
                renderApp();
                setTimeout(() => {
                    state.bookingForm.show = false;
                    state.bookingForm.confirmed = false;
                    renderApp();
                }, 2000);
            }
        };

        /* --- INITIALIZATION --- */
        window.addEventListener('scroll', () => {
            const isScrolled = window.scrollY > 20;
            if (state.scrolled !== isScrolled) {
                state.scrolled = isScrolled;
                renderNavbar();
                lucide.createIcons();
            }
        });

        // Initial Render
        renderApp();

    </script>
</body>
</html>